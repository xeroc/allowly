(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[652],{32711:(n,e,a)=>{Promise.resolve().then(a.bind(a,69814))},69814:(n,e,a)=>{"use strict";a.r(e),a.d(e,{default:()=>g});var t=a(56946),i=a(13112),o=a(75829),l=a(50253),r=a(39925),s=a(67500),c=a(42778),m=a(33455),d=a(12722),u=a(52695);let p='# Allowly Agent - Autonomous Pay-As-You-Go Allowances\n\n**Self-contained Skill for AI agents to check and manage Allowance budgets on Solana.**\n\n---\n\n## Overview\n\nCheck allowance availability, view pay-as-you-go policy details, and execute payment claims. Humans\nset up bounded allowance budgets, and you can check your available balance, view policy limits,\nmonitor claim history, and execute claims autonomously.\n\n## Use When\n\nYou need to:\n- Check how much USDC allowance is available\n- View pay-as-you-go policy details set by your human\n- Monitor claim history\n- Decide when to claim funds within per-claim limits\n- Execute payment claims against your allowance policy\n\n## Quick Start\n\n```javascript\n// Check your allowance status\nconst status = await checkAllowance();\n\nconsole.log(`\uD83D\uDCB0 Total Budget: ${status.totalBudget}`);\nconsole.log(`✅ Remaining: ${status.remaining}`);\nconsole.log(`⚡ Max per claim: ${status.maxPerClaim}`);\nconsole.log(`⏱️ Period: ${status.periodDays} days`);\nconsole.log(`\uD83D\uDD04 Period resets: ${status.periodEnd}`);\n```\n\n---\n\n## API Functions\n\n### checkAllowance(agentWallet)\n\nCheck available allowance balance and policy details.\n\n```javascript\n/**\n * Check allowance status and policy details\n *\n * @param {string} agentWallet - Agent\'s wallet public key (base58)\n * @returns {Promise<object>} Allowance status with budget, paid, remaining, limits\n */\nasync function checkAllowance(agentWallet) {\n  // Validate inputs\n  if (!agentWallet || typeof agentWallet !== "string") {\n    throw new Error("Invalid agent wallet address");\n  }\n\n  // Import Tributary SDK\n  const { Tributary } = await import("@tributary-so/sdk");\n  const { Connection, PublicKey, Wallet } = await import("@solana/web3.js");\n  const BN = await import("bn.js");\n\n  // Initialize connection\n  const connection = new Connection("https://api.mainnet-beta.solana.com", {\n    commitment: "confirmed",\n  });\n\n  try {\n    // 1. Fetch all payment policies where agent is recipient\n    const tributary = new Tributary(connection, new Wallet(agentWallet));\n\n    const policies = await tributary.getPaymentPoliciesByRecipient(\n      new PublicKey(agentWallet)\n    );\n\n    // 2. Filter for active pay-as-you-go policies\n    const paygPolicies = policies\n      .filter(({ account: policy }) => {\n        return (\n          policy.status.active !== undefined && // Check if active\n          "payAsYouGo" in policy.policyType\n        );\n      })\n      .map(({ publicKey: policyPda, account: policy }) => {\n        const payg = policy.policyType.payAsYouGo;\n        \n        // Convert from smallest units to human-readable (e.g., USDC has 6 decimals)\n        const decimals = 6; // USDC standard\n        const maxAmountPerPeriod = Number(payg.maxAmountPerPeriod) / 10 ** decimals;\n        const maxChunkAmount = Number(payg.maxChunkAmount) / 10 ** decimals;\n        const periodTotal = Number(payg.currentPeriodTotal) / 10 ** decimals;\n        \n        // Calculate period end time\n        const currentPeriodStart = Number(payg.currentPeriodStart) * 1000; // Unix to ms\n        const periodLengthMs = Number(payg.periodLengthSeconds) * 1000;\n        const periodEnd = new Date(currentPeriodStart + periodLengthMs);\n        \n        // Calculate remaining in period\n        const remaining = Math.max(0, maxAmountPerPeriod - periodTotal);\n        \n        // Check if period has expired\n        const now = Date.now();\n        const isPeriodActive = now >= currentPeriodStart && now < currentPeriodStart + periodLengthMs;\n\n        return {\n          id: policyPda.toString(),\n          totalBudget: maxAmountPerPeriod,\n          maxPerClaim: maxChunkAmount,\n          periodSeconds: Number(payg.periodLengthSeconds),\n          periodStart: new Date(currentPeriodStart).toISOString(),\n          periodEnd: periodEnd.toISOString(),\n          currentPeriodTotal: periodTotal,\n          remaining: isPeriodActive ? remaining : maxAmountPerPeriod,\n          status: policy.status.active !== undefined ? "active" : "paused",\n        };\n      });\n\n    // 3. Aggregate totals across all pay-as-you-go policies\n    const totalBudget = paygPolicies.reduce((sum, p) => sum + p.totalBudget, 0);\n    const totalPaid = paygPolicies.reduce((sum, p) => sum + p.currentPeriodTotal, 0);\n    const remaining = paygPolicies.reduce((sum, p) => sum + p.remaining, 0);\n    const maxPerClaim = Math.max(...paygPolicies.map(p => p.maxPerClaim));\n    const periodSeconds = Math.max(...paygPolicies.map(p => p.periodSeconds));\n\n    return {\n      totalBudget,\n      totalPaid,\n      remaining,\n      maxPerClaim,\n      periodSeconds,\n      periodDays: Math.round(periodSeconds / 86400), // Convert to days\n      periodEnd: paygPolicies.length > 0 ? paygPolicies[0].periodEnd : null,\n      policies: paygPolicies,\n    };\n\n  } catch (error) {\n    console.error("Error checking allowance:", error.message);\n    throw new Error(`Failed to check allowance: ${error.message}`);\n  }\n}\n\n/**\n * Execute a payment claim against a pay-as-you-go policy\n *\n * @param {string} agentWallet - Agent\'s wallet private key array of numbers\n * @param {PublicKey} policyPda - Payment policy PDA address (base58 string or PublicKey)\n * @param {number|BN} claimAmount - Amount to claim in smallest token units (e.g., 10000000 for 10 USDC)\n * @param {string} recipient - Recipient public key (base58 string)\n * @param {string} tokenMint - Token mint address (base58 string)\n * @param {string} gateway - Gateway public key (base58 string)\n * @returns {Promise<string>} Transaction signature\n */\nasync function executeClaim(agentWallet, policyPda, claimAmount, recipient, tokenMint, gateway) {\n  // Validate inputs\n  if (!agentWallet || !Array.isArray(agentWallet)) {\n    throw new Error("Invalid agent wallet keypair array");\n  }\n  if (!policyPda) {\n    throw new Error("Policy PDA address is required");\n  }\n  if (!claimAmount || claimAmount <= 0) {\n    throw new Error("Claim amount must be greater than 0");\n  }\n\n  // Import Tributary SDK\n  const { Tributary } = await import("@tributary-so/sdk");\n  const { Connection, PublicKey, Keypair } = await import("@solana/web3.js");\n  const BN = await import("bn.js");\n\n  // Initialize connection\n  const connection = new Connection("https://api.mainnet-beta.solana.com", {\n    commitment: "confirmed",\n  });\n\n  // Create Keypair from private key array\n  const keypair = Keypair.fromSecretKey(Uint8Array(agentWallet));\n\n  // Create Tributary SDK instance\n  const tributary = new Tributary(connection, keypair);\n\n  // Convert parameters to PublicKey if needed\n  const policyPdaPubkey = typeof policyPda === \'string\' \n    ? new PublicKey(policyPda) \n    : policyPda;\n  const recipientPubkey = new PublicKey(recipient);\n  const tokenMintPubkey = new PublicKey(tokenMint);\n  const gatewayPubkey = new PublicKey(gateway);\n\n  // Convert claim amount to BN if needed\n  const amountBN = claimAmount instanceof BN.BN ? claimAmount : new BN.BN(claimAmount);\n\n  try {\n    // Execute payment using Tributary SDK\n    const instructions = await tributary.executePayment(\n      policyPdaPubkey,\n      amountBN,\n      recipientPubkey,\n      tokenMintPubkey,\n      gatewayPubkey,\n      keypair.publicKey // user parameter (caller\'s wallet)\n    );\n\n    // Create and send transaction\n    const transaction = new Transaction().add(...instructions);\n\n    // Sign and send transaction\n    const signature = await connection.sendTransaction(\n      transaction,\n      [keypair],\n      {\n        commitment: "confirmed",\n      }\n    );\n\n    // Wait for confirmation\n    const confirmation = await connection.confirmTransaction(\n      signature,\n      "confirmed"\n    );\n\n    if (confirmation.value.err) {\n      throw new Error(`Transaction failed: ${JSON.stringify(confirmation.value.err)}`);\n    }\n\n    console.log(`✅ Payment claim successful: ${signature}`);\n    console.log(`\uD83D\uDCB0 Amount claimed: ${claimAmount}`);\n\n    return signature;\n\n  } catch (error) {\n    console.error("❌ Payment claim failed:", error);\n\n    // Handle common errors\n    if (error.message.includes("insufficient")) {\n      throw new Error("Insufficient token balance for this claim");\n    } else if (error.message.includes("exceeded")) {\n      throw new Error("Claim amount exceeds max per claim limit");\n    } else if (error.message.includes("period")) {\n      throw new Error("Payment period has not started or has ended");\n    } else {\n      throw new Error(`Failed to execute claim: ${error.message}`);\n    }\n  }\n}\n```\n\n**Parameters:**\n- `agentWallet`: Agent\'s wallet private key as array of numbers\n- `policyPda`: Payment policy PDA address (base58 string or PublicKey object)\n- `claimAmount`: Amount to claim in smallest token units (e.g., 10000000 for 10 USDC)\n- `recipient`: Recipient public key (base58 string)\n- `tokenMint`: Token mint address (base58 string)\n- `gateway`: Gateway public key (base58 string)\n\n**Returns:**\n- Transaction signature (base58 string)\n\n**Example:**\n```javascript\n// Execute a claim\nconst signature = await executeClaim(\n  [1, 2, 3, ..., 64],                              // agent wallet private key array\n  policy.id,                                       // policy PDA address\n  claimAmount * 1000000,                           // convert to smallest units (6 decimals)\n  "RECIPIENT_PUBLIC_KEY_HERE",                     // where to send funds\n  "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",  // USDC mint\n  "CwNybLVQ3sVmcZ3Q1veS6x99gUZcAF2duNDe3qbcEMGr"   // gateway\n  );\n\nconsole.log(`Claim signature: ${signature}`);\n```\n\n---\n\n## Usage Examples\n\n### Example 1: Check Allowance Before Task\n\n```javascript\n// Task that requires payment\nconst task = {\n  requiresPayment: true,\n  cost: 10,  // USDC\n  description: "OpenAI GPT-4"\n};\n\n// Check allowance first\nconst allowance = await checkAllowance(agentWallet);\n\nif (allowance.remaining >= task.cost && task.cost <= allowance.maxPerClaim) {\n  console.log(`✅ Sufficient allowance: ${allowance.remaining}`);\n  console.log(`✅ Within per-claim limit: max ${allowance.maxPerClaim}`);\n  console.log(`⏱️ Period resets in: ${allowance.periodEnd}`);\n  await executeTask(task);\n} else {\n  console.log(`❌ Insufficient allowance. Have ${allowance.remaining}, need ${task.cost}`);\n}\n```\n\n### Example 2: Smart Claim Sizing\n\n```javascript\nconst tasks = [\n  { name: "Send email", cost: 0.50 },\n  { name: "API call 1", cost: 2.00 },\n  { name: "API call 2", cost: 3.00 },\n];\n\nconst allowance = await checkAllowance(agentWallet);\nconst totalCost = tasks.reduce((sum, t) => sum + t.cost, 0);\n\n// Batch claim if within per-claim and total remaining limits\nif (totalCost <= allowance.maxPerClaim && totalCost <= allowance.remaining) {\n  console.log(`✅ Batch claim: ${totalCost} USDC`);\n  console.log(`⏱️ Period: ${allowance.periodDays} days`);\n  await executeAllTasks(tasks);\n} else {\n  console.log(`❌ Batch exceeds limits`);\n  console.log(`\uD83D\uDCB0 Per-claim max: ${allowance.maxPerClaim}`);\n  console.log(`\uD83D\uDCB0 Total remaining: ${allowance.remaining}`);\n}\n```\n\n### Example 3: Execute Claim After Checking Allowance\n\n```javascript\n// Check allowance and execute claim in one flow\nconst allowance = await checkAllowance(agentWallet);\nconst claimAmount = 10;  // 10 USDC\n\nif (allowance.remaining >= claimAmount && claimAmount <= allowance.maxPerClaim) {\n  // Get policy details from allowance response (use first active policy)\n  const policy = allowance.policies.find(p => p.status === "active");\n  \n  if (!policy) {\n    throw new Error("No active pay-as-you-go policy found");\n  }\n\n  // Execute a claim\n  const signature = await executeClaim(\n    [1,2,3,...,64],                                  // agent wallet private key array\n    policy.id,                                       // policy PDA address\n    claimAmount * 1000000,                           // convert to smallest units (6 decimals)\n    "RECIPIENT_PUBLIC_KEY_HERE",                     // where to send funds\n    "EPjFWdd5AufqSSqeM2qN1xzybapC8G4wEGGkZwyTDt1v",  // USDC mint\n    "CwNybLVQ3sVmcZ3Q1veS6x99gUZcAF2duNDe3qbcEMGr"   // gateway\n    );\n\n  console.log(`✅ Claim successful: ${signature}`);\n  console.log(`\uD83D\uDCB0 Amount: ${claimAmount} USDC`);\n  console.log(`\uD83D\uDD04 Remaining budget: ${allowance.remaining - claimAmount} USDC`);\n} else {\n  console.log(`❌ Insufficient allowance for ${claimAmount} USDC`);\n  console.log(`\uD83D\uDCB0 Have: ${allowance.remaining}, Need: ${claimAmount}`);\n}\n```\n';function g(){let[n,e]=(0,c.useState)(!1),a=async()=>{await navigator.clipboard.writeText(p),e(!0),setTimeout(()=>e(!1),2e3)},g=n=>{let{children:e}=n;return(0,t.jsx)("pre",{className:"!mt-0 !mb-0 !bg-transparent !p-0",children:e})};return(0,t.jsxs)("div",{className:"min-h-screen bg-primary-dark",children:[(0,t.jsx)(i.A,{mode:"agent"}),(0,t.jsx)(l.A,{mode:"agent"}),(0,t.jsx)(s.A,{mode:"agent"}),(0,t.jsx)(o.A,{}),(0,t.jsx)("div",{className:"max-w-4xl mx-auto py-16 px-4",children:(0,t.jsxs)("div",{className:"bg-white/5 backdrop-blur-sm rounded-2xl border border-white/10 p-8",children:[(0,t.jsxs)("h2",{className:"text-3xl font-bold text-white mb-4 flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-4xl",children:"\uD83E\uDD16"}),"Download Agent Skill"]}),(0,t.jsx)("p",{className:"text-gray-300 mb-6",children:"Copy this self-contained OpenClow skill file to give your AI agent the ability to check allowance and manage budgets autonomously."}),(0,t.jsxs)("div",{className:"bg-black/30 rounded-lg border border-white/10 p-4 mb-4",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"text-xs text-gray-400 font-mono",children:"SKILL.md - Self-contained"}),(0,t.jsx)("button",{onClick:()=>{let n=new Blob([p],{type:"text/markdown"}),e=URL.createObjectURL(n),a=document.createElement("a");a.href=e,a.download="allowly-agent-skill.md",document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(e)},className:"px-4 py-2 bg-accent hover:bg-accent/80 text-white rounded-lg text-sm font-medium transition-colors",children:"Download File"})]}),(0,t.jsx)("div",{className:"bg-black/50 rounded-lg p-4 max-h-96 overflow-y-auto overflow-x-auto text-sm prose prose-invert prose-sm max-w-none",children:(0,t.jsx)(m.oz,{components:{code:n=>{let{node:e,inline:a,className:i,children:o,...l}=n,r=/language-(\w+)/.exec(i||"");return!a&&r?(0,t.jsx)(d.A,{style:u.A,language:r[1],PreTag:g,customStyle:{borderRadius:"0.5rem",margin:0},...l,children:String(o).replace(/\n$/,"")}):(0,t.jsx)("code",{className:i,...l,children:o})}},children:p})}),(0,t.jsx)("button",{onClick:a,className:"w-full px-4 py-3 rounded-lg text-sm font-medium transition-colors ".concat(n?"bg-green-600 hover:bg-green-700 text-white":"bg-white/10 hover:bg-white/20 text-white"),children:n?"✅ Copied to clipboard!":"Copy skill to clipboard"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,t.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 border border-accent/20",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"✅ Self-Contained"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"No external dependencies or imports. Everything you need is in this one file."})]}),(0,t.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 border border-accent/20",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"\uD83E\uDD16 Agent-Ready"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"OpenClow-compatible skill designed for AI agents to check allowances autonomously."})]}),(0,t.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 border border-accent/20",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"\uD83D\uDCCA Budget Tracking"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"Functions to check remaining budget, max per claim, and period end date."})]}),(0,t.jsxs)("div",{className:"bg-accent/10 rounded-lg p-4 border border-accent/20",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-white mb-2",children:"\uD83D\uDD04 On-Demand Claims"}),(0,t.jsx)("p",{className:"text-sm text-gray-300",children:"Agents claim funds when needed, respecting human-set budget limits."})]})]}),(0,t.jsxs)("div",{className:"mt-6 pt-6 border-t border-white/10",children:[(0,t.jsxs)("p",{className:"text-sm text-gray-400 mb-2",children:[(0,t.jsx)("strong",{children:"Installation:"})," Save file as"," ",(0,t.jsx)("code",{className:"bg-white/10 px-1.5 py-0.5 rounded text-white font-mono",children:"SKILL.md"})," ","in your OpenClow skills directory."]}),(0,t.jsxs)("p",{className:"text-sm text-gray-400",children:[(0,t.jsx)("strong",{children:"Documentation:"})," Full usage guide included in the skill file."]})]})]})}),(0,t.jsx)(r.A,{})]})}}},n=>{n.O(0,[551,631,6,819,67,322,770,850,321,881,984,358],()=>n(n.s=32711)),_N_E=n.O()}]);